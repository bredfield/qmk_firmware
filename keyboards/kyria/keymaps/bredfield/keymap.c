#include QMK_KEYBOARD_H

uint16_t copy_paste_timer;
uint16_t enter_space_timer;

enum layers {
    QWERTY = 0,
    LOWER,
    RAISE,
    NAV,
    ADJUST
};

enum custom_keycodes {
    ENTSPC = SAFE_RANGE
};

// Layer switches aliases
#define ESC_LOW  LT(LOWER, KC_ESC)
#define TAB_RSE  LT(RAISE, KC_TAB)
#define SPC_NAV  LT(NAV, KC_SPACE)

// Mod taps
#define BSP_SFT  LSFT_T(KC_BSPC)

// GUI
#define GUI_SSF  SGUI(KC_3) // Full screen shot
#define GUI_SST  SGUI(KC_4) // Targetted screen shot
#define WIN_UP   LCAG(KC_UP)
#define WIN_DOWN LCAG(KC_DOWN)
#define WIN_LEFT LCAG(KC_LEFT)
#define WIN_RGHT LCAG(KC_RIGHT)

#define H_A      LGUI_T(KC_A)
#define H_S      LALT_T(KC_S)
#define H_D      LCTL_T(KC_D)
#define H_F      LSFT_T(KC_F)
#define H_G      LT(LOWER, KC_G)
#define H_H      LT(RAISE, KC_H)
#define H_J      LSFT_T(KC_J)
#define H_K      LCTL_T(KC_K)
#define H_L      LALT_T(KC_L)
#define H_SCLN   LGUI_T(KC_SCLN)

const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {
// Base
    [QWERTY] = LAYOUT(
//    ,----------------------------------------------------.                                    ,----------------------------------------------------.
      KC_TAB,  KC_Q,    KC_W,    KC_E,    KC_R,    KC_T,                                        KC_Y,    KC_U,    KC_I,     KC_O,    KC_P,    KC_GRV,
//    |----------------------------------------------------|                                    |----------------------------------------------------|
      KC_ESC,  H_A,     H_S,     H_D,     H_F,     H_G,                                         H_H,     H_J,     H_K,      H_L,     H_SCLN,  KC_QUOT,
//    |----------------------------------------------------+------------------------------------+----------------------------------------------------|
      KC_EQL,  KC_Z,    KC_X,    KC_C,    KC_V,    KC_B,    KC_HASH, KC_SPACE,KC_LEAD, KC_ASTR, KC_N,    KC_M,    KC_COMM,  KC_DOT,  KC_SLSH, KC_MINS,
//    |----------------------------------------------------+------------------------------------+----------------------------------------------------|
                                 XXXXXXX, KC_AMPR, ESC_LOW, BSP_SFT, KC_ENTER,KC_DEL,  SPC_NAV, TAB_RSE, KC_PIPE, XXXXXXX
//                               |---------------------------------------------------------------------------------------|
    ),

// Lower: Numberpad & Symbols
    [LOWER] = LAYOUT(
//    ,----------!--------@--------#--------$--------%-----.                                    ,---/---------------------------------,--------------.
      _______, KC_EXLM, KC_AT,   KC_HASH, KC_DLR,  KC_PERC,                                     KC_SLSH, KC_7,    KC_8,    KC_9,    KC_COMM, _______,
//    |----------^--------&--------*--------|--------\-----|                                    |---+---------------------------------.--------------|
      _______, KC_CIRC, KC_AMPR, KC_ASTR, KC_PIPE, KC_BSLS,                                     KC_PLUS, KC_4,    KC_5,    KC_6,    KC_DOT,  _______,
//    |----------------------------------------------------+------------------------------------+---_---------------------------------.--------------|
      _______, GUI_SSF, GUI_SST, _______, _______, _______, _______, _______, _______, _______, KC_UNDS, KC_1,    KC_2,    KC_3,    KC_0,    _______,
//    |-------------------------------------------------+---------------------------------------+----------------------------------------------------|
                                 _______, _______, _______, _______, _______, _______, _______, _______, _______, _______
//                               |---------------------------------------------------------------------------------------|
    ),

//  Raise: Brackets & Media
    [RAISE] = LAYOUT(
//    ,----------------------------------------------------.                                    ,----------{--------}--------------------------------.
      _______, KC_PAUS, _______, KC_VOLU, _______, _______,                                     _______, KC_LCBR, KC_RCBR, _______, _______, _______,
//    |----------------------------------------------------|                                    |----------(--------)--------------------------------|
      _______, KC_SLCK, KC_MPRV, KC_MPLY, KC_MNXT, _______,                                     _______, KC_LPRN, KC_RPRN, _______, _______, _______,
//    |----------------------------------------------------+------------------------------------+----------[--------]--------------------------------|
      _______, _______, _______, KC_VOLD, KC_MUTE, _______, _______, _______, _______, _______, _______, KC_LBRC, KC_RBRC, _______, _______, _______,
//    |----------------------------------------------------+--------------------------------------+--------------------------------------------------|
                                 _______, _______, _______, _______, _______, _______, _______, _______, _______, _______
//                               |---------------------------------------------------------------------------------------|
    ),

// Navigation & Window Tiling
    [NAV] = LAYOUT(
//    ,----------------------------------------------------.                                    ,----------------------------------------------------.
      _______, _______, _______, _______, _______, _______,                                     KC_PGUP, KC_HOME, KC_UP,   KC_END,  _______, KC_SLCK,
//    |----------------------------------------------------|                                    |----------------------------------------------------|
      _______, _______, _______, _______, _______, _______,                                     KC_PGDN, KC_LEFT, KC_DOWN, KC_RGHT, _______, KC_CAPS,
//    |----------------------------------------------------+------------------------------------+----------------------------------------------------|
      _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, WIN_LEFT,WIN_DOWN,WIN_UP,  WIN_RGHT,_______,
//    |----------------------------------------------------+------------------------------------+----------------------------------------------------|
                                 _______, _______, _______, _______, _______, _______, _______, _______, _______, _______
//                               |---------------------------------------------------------------------------------------|
    ),

// Adjust: LEDs & F Keys
    [ADJUST] = LAYOUT(
//    ,----------------------------------------------------.                                    ,----------------------------------------------------.
      _______, _______, _______, _______, _______, _______,                                     _______, KC_F7,   KC_F8,   KC_F9,   KC_F10,  _______,
//    |----------------------------------------------------|                                    |---------------------------------------------------|
      _______, _______, RGB_SAI, RGB_HUI, RGB_VAI, _______,                                     _______, KC_F4,   KC_F5,   KC_F6,   KC_F11,  _______,
//    |----------------------------------------------------+------------------------------------+----------------------------------------------------|
      _______, _______, RGB_SAD, RGB_HUD, RGB_VAD, _______, _______, _______, _______, _______, _______, KC_F1,   KC_F2,   KC_F3,   KC_F12,  _______,
//    |----------------------------------------------------+------------------------------------+----------------------------------------------------|
                                 _______, _______, _______, _______, _______, _______, _______, _______, _______, _______
//                               |---------------------------------------------------------------------------------------|
    ),

// Layer Template
//     [_LAYERINDEX] = LAYOUT(
//    ,----------------------------------------------------.                                    ,----------------------------------------------------.
//    _______, _______, _______, _______, _______, _______,                                     _______, _______, _______, _______, _______, _______,
//    |----------------------------------------------------|                                    |---------------------------------------------------|
//    _______, _______, _______, _______, _______, _______,                                     _______, _______, _______, _______, _______, _______,
//    |----------------------------------------------------+------------------------------------+----------------------------------------------------|
//    _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______,
//    |----------------------------------------------------+------------------------------------+----------------------------------------------------|
//                               _______, _______, _______, _______, _______, _______, _______, _______, _______, _______
//                               |---------------------------------------------------------------------------------------|
};

layer_state_t layer_state_set_user(layer_state_t state) {
    return update_tri_layer_state(state, LOWER, RAISE, ADJUST);
}

bool process_record_user(uint16_t keycode, keyrecord_t *record) {
    switch (keycode) {
        case ENTSPC:  // Enter / hold space
            if (record->event.pressed) {
                enter_space_timer = timer_read();
                register_code(KC_SPACE);
            } else {
                if (timer_elapsed(enter_space_timer) < TAPPING_TERM) {
                    tap_code16(KC_ENTER);
                }
                unregister_code(KC_SPACE);
            }
            break;
    }
    return true;
}

uint16_t get_tapping_term(uint16_t keycode) {
  switch (keycode) {
    case BSP_SFT:
        return TAPPING_TERM - 100;
    default:
      return TAPPING_TERM;
  }
}

LEADER_EXTERNS();

void matrix_scan_user(void) {
    LEADER_DICTIONARY() {
        leading = false;
        leader_end();
        // Programming
        SEQ_ONE_KEY(KC_C) { // Inline Code
            SEND_STRING("`` " SS_TAP(X_LEFT) SS_TAP(X_LEFT));
        }
        SEQ_TWO_KEYS(KC_G, KC_A) {
            SEND_STRING("git add .; git commit -am ''" SS_TAP(X_LEFT));
        }
        SEQ_TWO_KEYS(KC_D, KC_E) {
            SEND_STRING("/srv/docker-entrypoint.sh ");
        }
        SEQ_TWO_KEYS(KC_D, KC_S) {
            SEND_STRING("python manage.py shell");
        }
        // Emails
        SEQ_TWO_KEYS(KC_E, KC_D) { // Email Density
            SEND_STRING("ben@density.io");
        }
        SEQ_TWO_KEYS(KC_E, KC_P) { // Email personal
            SEND_STRING("bredfield@gmail.com");
        }
        SEQ_TWO_KEYS(KC_E, KC_B) { // Email Bread
            SEND_STRING("ben@madebybread.com");
        }
        // Emojis
        SEQ_ONE_KEY(KC_V) { // V
            SEND_STRING(":v:");
        }
        SEQ_ONE_KEY(KC_O) { // Okay
            SEND_STRING(":ok_hand:");
        }
        SEQ_ONE_KEY(KC_EQL) { // Thumbs up
            SEND_STRING(":+1:");
        }
        SEQ_ONE_KEY(KC_MINS) { // Thumbs down
            SEND_STRING(":-1:");
        }
        SEQ_TWO_KEYS(KC_C, KC_K) { // Chef kiss
            SEND_STRING(":chefkiss:");
        }
    }
}

#ifdef OLED_DRIVER_ENABLE
oled_rotation_t oled_init_user(oled_rotation_t rotation) {
	return OLED_ROTATION_180;
}

static void render_bread_logo(void) {
    static const char PROGMEM bread_logo[] = {
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0x80, 0x80, 0x80, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xe0, 0xf8,
0xfc, 0xfc, 0x3e, 0x3f, 0x3f, 0x77, 0x7f, 0x7f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
0xff, 0xff, 0xff, 0xfe, 0xfe, 0xfe, 0xfe, 0xfc, 0xfc, 0xf8, 0xf8, 0xf0, 0xe0, 0xc0, 0x80, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff,
0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x01, 0x03,
0x03, 0x07, 0x07, 0x0f, 0x1f, 0x3f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
0xfc, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff,
0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
0x7f, 0x1f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff,
0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x60, 0xf0, 0xfc, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfc,
0xf8, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff,
0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
0xff, 0x7f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x0f,
0x1f, 0x1f, 0x38, 0x38, 0x38, 0x38, 0x70, 0x70, 0x70, 0x70, 0xe0, 0xe0, 0xe0, 0xe0, 0xc0, 0xc0,
0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xe0, 0xf0, 0x7f, 0x3f, 0x1f, 0x1f, 0x0f, 0x07, 0x03, 0x03,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x01,
0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
    };
    oled_write_raw_P(bread_logo, sizeof(bread_logo));
}

static void render_status(void) {
    oled_write_P(PSTR("Oh, hi."), false);

    // Host Keyboard Layer Status
    oled_write_P(PSTR("\n\nLayer: "), false);
    switch (get_highest_layer(layer_state)) {
        case QWERTY:
            oled_write_P(PSTR("Default\n"), false);
            break;
        case LOWER:
            oled_write_P(PSTR("Lower\n"), false);
            break;
        case RAISE:
            oled_write_P(PSTR("Raise\n"), false);
            break;
        case NAV:
            oled_write_P(PSTR("Navigation\n"), false);
            break;
        case ADJUST:
            oled_write_P(PSTR("Adjust\n"), false);
            break;
        default:
            oled_write_P(PSTR("Undefined\n"), false);
    }

    // Host Keyboard LED Status
    uint8_t led_usb_state = host_keyboard_leds();
    oled_write_P(IS_LED_ON(led_usb_state, USB_LED_NUM_LOCK)    ? PSTR("NUMLCK ") : PSTR("       "), false);
    oled_write_P(IS_LED_ON(led_usb_state, USB_LED_CAPS_LOCK)   ? PSTR("CAPLCK ") : PSTR("       "), false);
    oled_write_P(IS_LED_ON(led_usb_state, USB_LED_SCROLL_LOCK) ? PSTR("SCRLCK ") : PSTR("       "), false);
}

void oled_task_user(void) {
    if (is_keyboard_master()) {
        render_status(); // Renders the current keyboard state (layer, lock, caps, scroll, etc)
    } else {
        render_bread_logo();
    }
}
#endif
